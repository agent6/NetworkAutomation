---
- name: Remove specified user from NX-OS switch and log the action
  hosts: all
  gather_facts: false
  collections:
    - cisco.nxos

  tasks:
    - name: Ensure the user is absent
      nxos_user:
        name: "{{ nxos_user_to_remove }}"
        state: absent

    - name: Save configuration to startup-config
      nxos_config:
        save_when: modified